# Mentorship Matching System

This document provides an overview of the mentorship matching system and how matches are generated, stored, and managed.

## Overview

The mentorship system has the following components:

1. **Match Generation** - Creates matches between mentors and mentees using AI
2. **Match Storage** - Stores matches in Firebase Firestore database
3. **Match Retrieval** - Retrieves matches for specific users
4. **Match Status Updates** - Allows users to confirm or reject matches

## Match Flow

1. **Creation**: 
   - Matches are initially generated using the `/generate-matches` endpoint or manually created with `/create-test-match`
   - Each match is assigned a status of `pending` or `approved` (for test matches)

2. **Admin Approval**:
   - In a production system, administrators would review and approve matches
   - This sets the status to `approved`

3. **User Confirmation**:
   - When a match is `approved`, it appears on the mentee's dashboard for confirmation
   - Mentees can either `confirm` or `reject` the match
   - This is done through the `/update-match-status` endpoint

4. **Final State**:
   - Confirmed matches have status `confirmed`
   - Rejected matches have status `rejected`

## Match Data Structure

Each match contains the following fields:

```javascript
{
  "id": "unique-match-id",           // Generated by Firestore
  "menteeId": "user-id-of-mentee",   // User ID of the mentee
  "mentorId": "user-id-of-mentor",   // User ID of the mentor
  "status": "pending",               // One of: pending, approved, confirmed, rejected
  "matchReason": "Why this match was made", // Explanation of the match
  "compatibilityScore": 85,          // Score from 0-100
  "createdAt": "2025-04-16T12:00:00.000Z", // ISO date string
  "updatedAt": "2025-04-16T12:00:00.000Z", // ISO date string when status changes
  "updatedBy": "user-id"             // User ID who made the last update
}
```

## API Endpoints

### 1. Generate Matches

```
POST /generate-matches
```

Generates AI-powered matches between mentors and mentees.

**Request Body:**
```json
{
  "mentors": [
    {"id": "mentor-1", "name": "John Doe", "major": "Computer Science", ...},
    ...
  ],
  "mentees": [
    {"id": "mentee-1", "name": "Jane Smith", "major": "Biology", ...},
    ...
  ],
  "maxMenteesPerMentor": 3,  // Optional, default is calculated dynamically
  "saveToDatabase": true     // Optional, default is true
}
```

**Response:**
```json
{
  "message": "Successfully generated 5 matches",
  "matches": [...],          // Array of match objects
  "stored_match_ids": [...], // IDs of stored matches
  "saved_to_database": true  // Whether matches were saved
}
```

### 2. Create Test Match

```
POST /create-test-match
```

Creates a test match with status "approved" for testing.

**Request Body:**
```json
{
  "mentorId": "mentor-id",
  "menteeId": "mentee-id"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Test match created successfully",
  "matchId": "match-id",
  "match": {...} // Match object
}
```

### 3. Get User Matches

```
POST /get-user-matches
```

Retrieves all matches for a specific user (as mentor or mentee).

**Request Body:**
```json
{
  "userId": "user-id"
}
```

**Response:**
```json
{
  "menteeMatches": [...], // Matches where user is mentee
  "mentorMatches": [...]  // Matches where user is mentor
}
```

### 4. Update Match Status

```
POST /update-match-status
```

Updates the status of a match (confirm or reject).

**Request Body:**
```json
{
  "matchId": "match-id",
  "status": "confirmed", // One of: pending, approved, confirmed, rejected
  "userId": "user-id"    // Must be mentor or mentee of this match
}
```

**Response:**
```json
{
  "success": true,
  "message": "Match status updated to confirmed",
  "timestamp": "2025-04-16T12:00:00.000Z"
}
```

## Testing the Match Flow

1. **Create a test match**:
   ```bash
   ./create_test_match.sh mentor-id mentee-id
   ```

2. **Get matches for a user**:
   ```bash
   curl -X POST "http://127.0.0.1:5001/get-user-matches" \
     -H "Content-Type: application/json" \
     -d '{"userId": "mentee-id"}'
   ```

3. **Update match status**:
   ```bash
   curl -X POST "http://127.0.0.1:5001/update-match-status" \
     -H "Content-Type: application/json" \
     -d '{"matchId": "match-id", "status": "confirmed", "userId": "mentee-id"}'
   ```

4. **Run full test flow**:
   ```bash
   ./test_mentorship_flow.sh
   ```

## Security Setup

### API Keys and Credentials

This application requires two main credentials:
1. **Firebase Service Account Key**: Used to authenticate with Firebase Firestore
2. **Gemini API Key**: Used to access Google's Gemini AI API

**IMPORTANT: Never commit these credentials to the repository.**

### Proper Credential Setup

1. Store your Firebase service account key file securely OUTSIDE of the project directory
   - Go to Firebase Console > Project Settings > Service Accounts
   - Generate a new private key (JSON file)
   - Save it in a secure location not tracked by git

2. Set environment variables in your `.env` file:
   ```
   FIREBASE_CREDENTIALS_PATH=/path/to/your/secure/service-account-key.json
   GEMINI_API_KEY=your-gemini-api-key
   ```

3. When deploying to production:
   - Consider using a secrets manager service
   - Set environment variables at the hosting/container level
   - Rotate credentials regularly
   - Use the principle of least privilege for service accounts
